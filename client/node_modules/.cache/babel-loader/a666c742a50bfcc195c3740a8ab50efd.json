{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\logme\\\\Dropbox\\\\Projekty_kody\\\\node.js\\\\react-apps\\\\merta-site\\\\src\\\\movies\\\\MovieForm.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport FlashMessage from '../common/FlashMessage';\nimport { ApiGet, ApiPost, ApiPut } from \"../common/Api\";\nimport Genre from './Genre';\nimport InputField from '../common/InputField';\nimport InputSelect from '../common/InputSelect';\nimport InputCheck from '../common/InputCheck';\nimport { useLocation, useParams } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst MovieForm = (props, hooks) => {\n  _s();\n\n  // inicializace proměnných pomocí useState()\n  const [movieIdState, setMovieId] = useState(null);\n  const [directorListState, setDirectorList] = useState([]);\n  const [actorListState, setActorList] = useState([]);\n  const [genreListState, setGenreList] = useState([]);\n  const [movieNameState, setMovieName] = useState('');\n  const [yearState, setYear] = useState(0);\n  const [directorState, setDirector] = useState('');\n  const [actorsState, setActors] = useState([]);\n  const [genresState, setGenres] = useState([]);\n  const [availableState, setAvailable] = useState(false);\n  const [sentState, setSent] = useState(false);\n  const [successState, setSuccess] = useState(false);\n  const [errorState, setError] = useState();\n  const location = useLocation();\n  const {\n    id\n  } = useParams(); // handleChange(e) {obluha vstupů formuláře}\n\n  const handleChange = e => {\n    const target = e.target;\n    let temp;\n\n    if (['actors', 'genres'].includes(target.name)) {\n      temp = Array.from(target.selectedOptions, item => item.value);\n    } else if (target.name === 'available') {\n      temp = target.checked;\n    } else {\n      temp = target.value;\n    }\n\n    const name = target.name;\n    const value = temp;\n\n    if (name === 'movieName') {\n      console.log(value);\n      setMovieName(value);\n    } else if (name === 'year') {\n      console.log(value);\n      setYear(value);\n    } else if (name === 'director') {\n      console.log(value);\n      setDirector(value);\n    } else if (name === 'actors') {\n      console.log(value);\n      setActors(value);\n    } else if (name === 'genres') {\n      console.log(value);\n      setGenres(value);\n    } else if (name === 'available') {\n      console.log(value);\n      setAvailable(value);\n    }\n\n    ;\n  }; // handleSubmit(e) {obsluha odeslání formuláře}\n\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    const body = {\n      name: movieNameState,\n      year: yearState,\n      directorID: directorState,\n      actorIDs: actorsState,\n      genres: genresState,\n      isAvailable: availableState\n    };\n    (movieIdState ? ApiPut('/api/movies/' + id, body) : ApiPost('/api/movies/', body)).then(data => {\n      console.log('succcess', data);\n      setSent(true);\n      setSuccess(true);\n      location('/movies');\n    }).catch(async error => {\n      const er = await error;\n      console.log(er.message);\n      setError(er.message);\n      setSent(true);\n      setSuccess(false);\n    });\n  }; // {načtení existujícího záznamu}\n\n\n  useEffect(() => {\n    const _id = id || null;\n\n    if (_id) {\n      setMovieId(id);\n      ApiGet(\"/api/movies/\" + id).then(data => {\n        setMovieName(data.name);\n        setYear(data.year);\n        setDirector(data.directorID);\n        setActors(data.actorIDs);\n        setGenres(data.genres);\n        setAvailable(data.isAvailable);\n      });\n    }\n\n    ApiGet('/api/directors').then(data => setDirectorList(data));\n    ApiGet('/api/actors').then(data => setActorList(data));\n    ApiGet('/api/genres').then(data => setGenreList(data));\n  }, []); // vykreslení formuláře\n\n  const sent = sentState;\n  const success = successState;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: [id ? \"Upravit\" : \"Vytvořit\", \" film\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 13\n    }, this), errorState ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"alert alert-danger\",\n      children: errorState\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 27\n    }, this) : \"\", sent && /*#__PURE__*/_jsxDEV(FlashMessage, {\n      theme: success ? \"success\" : \"\",\n      text: success ? \"Uložení filmu proběhlo úspěšně.\" : \"\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(InputField, {\n        required: true,\n        type: \"text\",\n        name: \"movieName\",\n        min: \"3\",\n        label: \"N\\xE1zev\",\n        prompt: \"Zadejte n\\xE1zev d\\xEDla\",\n        value: movieNameState,\n        handleChange: handleChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(InputField, {\n        required: true,\n        type: \"number\",\n        name: \"year\",\n        label: \"Rok vyd\\xE1n\\xED\",\n        prompt: \"Zadejte rok vyd\\xE1n\\xED\",\n        min: \"0\",\n        value: yearState,\n        handleChange: handleChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(InputSelect, {\n        required: true,\n        name: \"director\",\n        items: directorListState,\n        label: \"Re\\u017Eie\",\n        prompt: \"Vyberte re\\u017Eis\\xE9ra\",\n        value: directorState,\n        handleChange: handleChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(InputSelect, {\n        required: true,\n        name: \"actors\",\n        items: actorListState,\n        multiple: true,\n        label: \"Hraj\\xED\",\n        prompt: \"Ozna\\u010Dte herce\",\n        value: actorsState,\n        handleChange: handleChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(InputSelect, {\n        required: true,\n        name: \"genres\",\n        items: genreListState,\n        multiple: true,\n        enum: Genre,\n        label: \"\\u017D\\xE1nr\",\n        prompt: \"Ozna\\u010Dte \\u017E\\xE1nry\",\n        value: genresState,\n        handleChange: handleChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(InputCheck, {\n        type: \"checkbox\",\n        name: \"available\",\n        label: \"Dostupn\\xFD\",\n        value: availableState,\n        checked: availableState,\n        handleChange: handleChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"submit\",\n        className: \"btn btn-primary\",\n        value: \"Ulo\\u017Eit\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 9\n  }, this);\n};\n\n_s(MovieForm, \"D9zZmsAPr/K8R47u8um2u0j1DLo=\", false, function () {\n  return [useLocation, useParams];\n});\n\n_c = MovieForm;\nexport default MovieForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"MovieForm\");","map":{"version":3,"sources":["C:/Users/logme/Dropbox/Projekty_kody/node.js/react-apps/merta-site/src/movies/MovieForm.js"],"names":["React","useState","useEffect","FlashMessage","ApiGet","ApiPost","ApiPut","Genre","InputField","InputSelect","InputCheck","useLocation","useParams","MovieForm","props","hooks","movieIdState","setMovieId","directorListState","setDirectorList","actorListState","setActorList","genreListState","setGenreList","movieNameState","setMovieName","yearState","setYear","directorState","setDirector","actorsState","setActors","genresState","setGenres","availableState","setAvailable","sentState","setSent","successState","setSuccess","errorState","setError","location","id","handleChange","e","target","temp","includes","name","Array","from","selectedOptions","item","value","checked","console","log","handleSubmit","preventDefault","body","year","directorID","actorIDs","genres","isAvailable","then","data","catch","error","er","message","_id","sent","success"],"mappings":"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","sourcesContent":["import React, { useState, useEffect  } from 'react';\r\nimport FlashMessage from '../common/FlashMessage';\r\nimport { ApiGet, ApiPost, ApiPut } from \"../common/Api\";\r\nimport Genre from './Genre';\r\nimport InputField from '../common/InputField';\r\nimport InputSelect from '../common/InputSelect';\r\nimport InputCheck from '../common/InputCheck';\r\nimport { useLocation, useParams } from 'react-router-dom';\r\n\r\nconst MovieForm =  (props, hooks) => {\r\n\r\n    // inicializace proměnných pomocí useState()\r\n    const [movieIdState, setMovieId] = useState(null);\r\n    const [directorListState, setDirectorList] = useState([]);\r\n    const [actorListState, setActorList] = useState([]);\r\n    const [genreListState, setGenreList] = useState([]);\r\n    const [movieNameState, setMovieName] = useState('');\r\n    const [yearState, setYear] = useState(0);\r\n    const [directorState, setDirector] = useState('');\r\n    const [actorsState, setActors] = useState([]);\r\n    const [genresState, setGenres] = useState([]);\r\n    const [availableState, setAvailable] = useState(false);\r\n    const [sentState, setSent] = useState(false);\r\n    const [successState, setSuccess] = useState(false);\r\n    const [errorState, setError] = useState()\r\n    const location = useLocation();\r\n\r\n    const { id } = useParams();\r\n    // handleChange(e) {obluha vstupů formuláře}\r\n    const handleChange = (e) => {\r\n        const target = e.target;\r\n        \r\n        let temp;\r\n        if (['actors', 'genres'].includes(target.name)) {\r\n            temp = Array.from(target.selectedOptions, (item) => item.value);\r\n        }\r\n        else if (target.name === 'available') {\r\n            temp = target.checked;\r\n        }\r\n        else {\r\n            temp = target.value;\r\n        }\r\n\r\n        const name = target.name;\r\n        const value = temp;\r\n\r\n        if (name === 'movieName') { console.log(value); setMovieName(value);}\r\n        else if (name === 'year') {console.log(value); setYear(value);}\r\n        else if (name === 'director'){console.log(value); setDirector(value);}\r\n        else if (name === 'actors') {console.log(value); setActors(value);}\r\n        else if (name === 'genres') {console.log(value); setGenres(value);}\r\n        else if (name === 'available'){console.log(value); setAvailable(value)};\r\n      };\r\n      \r\n    // handleSubmit(e) {obsluha odeslání formuláře}\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n\r\n        const body = {\r\n            name: movieNameState,\r\n            year: yearState,\r\n            directorID: directorState,\r\n            actorIDs: actorsState,\r\n            genres: genresState,\r\n            isAvailable: availableState,\r\n        };\r\n\r\n\r\n        (movieIdState\r\n            ? ApiPut('/api/movies/' + id, body)\r\n            :  ApiPost('/api/movies/', body)\r\n        )\r\n            .then((data) => {\r\n                console.log('succcess', data);\r\n                setSent(true);\r\n                setSuccess(true);\r\n                location('/movies')\r\n\r\n            })\r\n            .catch(async (error) => {\r\n                const er = await error;\r\n                console.log(er.message);\r\n                setError(er.message);\r\n                setSent(true);\r\n                setSuccess(false);\r\n            });\r\n      };\r\n\r\n    // {načtení existujícího záznamu}\r\n    useEffect(() => {\r\n        const _id = id || null;\r\n    \r\n        if (_id) {\r\n            setMovieId(id);\r\n    \r\n            ApiGet(\"/api/movies/\" + id).then((data) => {\r\n                setMovieName(data.name);\r\n                setYear(data.year);\r\n                setDirector(data.directorID);\r\n                setActors(data.actorIDs);\r\n                setGenres(data.genres);\r\n                setAvailable(data.isAvailable);\r\n            });\r\n        }\r\n    \r\n\r\n        ApiGet('/api/directors').then((data) => setDirectorList(data));\r\n        ApiGet('/api/actors').then((data) => setActorList(data));\r\n        ApiGet('/api/genres').then((data) => setGenreList(data));\r\n    }, []);\r\n    // vykreslení formuláře\r\n    const sent = sentState;\r\n    const success = successState;\r\n    return (\r\n        <div>\r\n            <h1>{id ? \"Upravit\" : \"Vytvořit\"} film</h1>\r\n            <hr />\r\n            {errorState ? <div className=\"alert alert-danger\">{errorState}</div> : \"\"}\r\n            {sent && (\r\n                <FlashMessage\r\n                    theme={success ? \"success\" : \"\"}\r\n                    text={success ? \"Uložení filmu proběhlo úspěšně.\" : \"\"}\r\n                />\r\n            )}\r\n\r\n            <form onSubmit={handleSubmit}>\r\n            <InputField\r\n                    required={true}\r\n                    type=\"text\"\r\n                    name=\"movieName\"\r\n                    min=\"3\"\r\n                    label=\"Název\"\r\n                    prompt=\"Zadejte název díla\"\r\n                    value={movieNameState}\r\n                    handleChange={handleChange}\r\n            />\r\n\r\n            <InputField\r\n                    required={true}\r\n                    type=\"number\"\r\n                    name=\"year\"\r\n                    label=\"Rok vydání\"\r\n                    prompt=\"Zadejte rok vydání\"\r\n                    min=\"0\"\r\n                    value={yearState}\r\n                    handleChange={handleChange}\r\n            />\r\n\r\n            <InputSelect\r\n                    required={true}\r\n                    name=\"director\"\r\n                    items={directorListState}\r\n                    label=\"Režie\"\r\n                    prompt=\"Vyberte režiséra\"\r\n                    value={directorState}\r\n                    handleChange={handleChange}\r\n            />\r\n\r\n            <InputSelect\r\n                    required={true}\r\n                    name=\"actors\"\r\n                    items={actorListState}\r\n                    multiple={true}\r\n                    label=\"Hrají\"\r\n                    prompt=\"Označte herce\"\r\n                    value={actorsState}\r\n                    handleChange={handleChange}\r\n            />\r\n\r\n            <InputSelect\r\n                    required={true}\r\n                    name=\"genres\"\r\n                    items={genreListState}\r\n                    multiple={true}\r\n                    enum={Genre}\r\n                    label=\"Žánr\"\r\n                    prompt=\"Označte žánry\"\r\n                    value={genresState}\r\n                    handleChange={handleChange}\r\n            />\r\n\r\n            <InputCheck\r\n                    type=\"checkbox\"\r\n                    name=\"available\"\r\n                    label=\"Dostupný\"\r\n                    value={availableState}\r\n                    checked={availableState}\r\n                    handleChange={handleChange}\r\n            />\r\n\r\n            <input type=\"submit\" className=\"btn btn-primary\" value=\"Uložit\" />\r\n            </form>\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nexport default MovieForm;"]},"metadata":{},"sourceType":"module"}